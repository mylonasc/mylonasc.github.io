---
layout: post
title: Single-channel percursive localization with Deep CNNs
subtitle: 
bigimg: /img/bannerAcLoc.png
tags: [Localization, Compressive Sensing, Incoherent Measurements, Deep Convolutional Neural Networks]
---
# Motivation
Normaly to localize an acoustic source, one needs multiple channel recordings from multiple channels. For the case of impulse excitations in particular (percursive excitations - something hitting the thing) it is easy to localize the source when one can simultaneously read multiple channels. Depending on the damping characteristics, it could even be impossible to localize the source in 2D if records from multiple sensors do not exist.

The "DIY" route to that, is buying a cheap FPGA and learning to program it. I have resisted this temptation because I know some very smart people that do program FPGAs and they attest to the difficulty of programming them. Given that in general multi-track recording is expensive, and I'm quite bad at soldering, and I don't have the patience or time to source multiplexers etc, I thought of trying something else.

## The math background
There is a theory called **compressive sensing** that states that when we have a signal that consists of some components, mixed in an unknown way,
 we can fully recover it if we sample in a smart way, and beat classical bounds on sampling frequency (Nyquist frequency) for fully recovering the signal.
Namely, the trick is to replace regular sampling with randomized sampling. One important consequence of this 
theory is that if you get a scalar signal that consists of signals of some sensors, that have been multiplied and shifted 
in any way that is different for each different sensor, you can fully recover the original signals. 
This used to surprise me since it is quite counter-intuitive! Now when I think of this, the simplest example of compressive sensing that comes to mind, is the simplest construction of an  invertible matrix: Just put random values in a matrix and it's invertible! It's *extremely* unlikely that you get a non-invertible random matrix if you dont impose some more structure. We impose such a structure with recular sampling! We can destroy it by non-regular sampling! Anyway, not sure how accurate is my understanding, but I'm quite convinced that compressive sensing makes sense and regular sampling has few good things to offer.

## Elastodynamics of plates, and a simple compressive electric circuit:
How does compressive sensing come into play when finding the excited eigenmodes of a structure? 
It is easier to think of a string:

[harmonics](img/guitarharm.jpg)

Say we want to get the precise reconstruction of the vibration of a string.
 And we have 3 sensors. If the string is excited in its 3rd harmonic and 
we place the sensors on the nodes of the 3rd harmonic (the places that there 
is no displacement when the harmonic is excited) we will be able to sense nothing!
 Note also that all multiples of the 3rd harmonic are lost (for example the 
nodes of the 6th harmonic are also nodes of the 3rd harmonic). If we randomly 
place the sensors on the string, it is extremely unlikely that they will end 
up all on nodes of harmonics so we'll always sense a mixture of modes! 
And of course an arbitrary excitation is going to be a mixture of several harmonics.

For a related reason, a square or generally symmetric rooms are bad for listening
 to music or playing music. There are "modes" of the air in the room that are not 
well excited and others that are over excited, and the audience can't listen correctly 
to the overtones of the instrument (audience hears "the room" as well in some sense).

In two dimensions, a similar situation arises. Random sensor placement is optimal 
sensor placement in a certain sense! It is most probable to get incoherent measurements if 
you use randomly placed sensors. If one places sensors in a symmetric manner on 
a symmetric structure it is highly likely that information will be lost or not
retrieved in an optimal manner.

## The actual single-channel 2D impulse locator:
My purpose is not, and never was, to fully reconstruct the signal from multiple sensors!
I need some simple **integrating** hardware that returns a 1D representation of the signal 
from all the sensors, which is expected to be unique depending on which sensor has 
been excited and to some extent on the induced dynamics of charges messing with the piezo-disks.
I do not want to actually capture the signal - I just need an algorithm that can automatically 
identify the signal and use the signal for localization.
By integrating, I mean that I want my signal from all sensors to somehow affect the 1D signal in 
a unique way that I can potentially exploit in a downstream task.
The simplest integrator I can think of is a capacitor! Luckily, piezoelectric disks
are capacitors themselves! Therefore the compressive sensing circuit is the sensor itself!

It should be noted that the piezos are not exactly passive. They do act as capacitors, which is a passive component, but they also
 create a charge when they are excited. This charge is either neutralized locally due to leakage in the piezo,
 or becomes current in a closed circuit connected to the capacitor. When we use piezos as sensors, we take 
advantage of the latter obviously. Finally, since piezo-disks are **transducers** they deform under charge. 
Piezos are often used as ultra-cheap speakers for appliances (if you have a home appliance that creates 
a high-pitched sound it probably uses a piezoelectric disk). Piezoelectric components are often 
used as active sensing components. One may use use them to excite your structure as well.
The most interesting application of that is the ultrasound. The ultrasound probe contains an array 
of piezoelectric components that send a high-pitched elastic signal (in the ultrasound range) 
and they sense it when it gets reflected. By some phasing tricks, the tomographic information of 
the underlying tissue is relatively easy to reconstruct with appropriate hardware. By the way, 
the idea of using compressive sensing for cheaper ultrasound machines has already been used!
 [Here is a link to the research](https://advances.sciencemag.org/content/3/12/e1701423). 

In my experiment, I have an acrylic plate with 3 piezoelectric sensors connected in series, supported with hot-glue (see picture). The sensors 
were connected in series because I want them to develop some recharging/uncharging dynamics in tandem with the dynamics of the plate. 
This would not be possible in parallel, since the charge would simply sink to the soundcard.
Note also that I do not put them in regular positions and I perturm the support of the plate (the corks I hot-glued). 
I tap the plate with a plastic pen and I record the mixed signal in a single channel. 
The signal is expected to be unique for each tap location due to the coupled elastodynamics and electrodynamics of the piezos.

With my ghetto weekend project, I only do 2D localization on a plate. Here is a bottom view of the plate.
[piezo plate - bottom view](img/piezoexp1.jpg)

And a top view, where I sketched a 5x8 grid

[piezo plate](img/piezoexp2.jpg)

### Excitation
So with some patience, I managed to collect more than 2k taps on this plate... The trick is to transform the task into an as brainless and repetitive one as possible. So I tap the boxes in series from 0,0 to 4,7, always in the same order. I record in Audacity with 44khz sampling frequency. Finally I have a python script that identifies the peaks of the taps, and assigns them to the correct box by the order that the taps came. The are located around the peak of each tap. Namely 1k samples before the peak and 3k samples after the peak. 

After collecting the taps some first encouraging results with PCA were observed.
Namely, while plotting the distribution of the PCA components for each box, we see that there are some patterns emerging that indeed seem to fingerpring the excitation  position. 

[pca components](img/pcacomps.png)

The different rows of each matrix plot correspond to different independent measurements. In my reading of the plot, 
PCA analysis captured some variations that have to do with the variation that I wanted to capture in the first place! Namely the 
localization info - whether there is something in the signal that is unique at each tap location due to the system dynamics. 
Equipped with this new knowledge, I proceeded to try training a predictive model. 

## Densenet Network
I used a simple densenet model with 5 layers of filters of size 10, with relus and dilations of size 2. I made a loss function that classified the x and y position separately (so I can have more "bits" of information entering my network). Almost to my surprize, the network performed really well from the first try! This was surprizing for these reasons:
* This almost never happens
* I fed raw high-frequency audio signals - no FFT or wavelet processing (or featurizing) and no denoising.

Here are the confusion matrices on the whole set. I used a training set of around 2k samples and 500 samples as validation set, with sampling for validation set stratified by tap position (5x8 = 40 strata). Here are the confusion matrices for the whole dataset:
[confusion - x](img/confx.png)
[confusion - y](img/confy.png)

For some reason matplotlib does not want to plot my confusion matrix nicely. I gave up. Anyway, the results are good at least!

I tried it also with completely new examples and the accuracy is as good! I'm not entirely surprized this works - but I have to admit that I'm quite surprized this worked so easilly!

## Conclusions
Compressive sensing theory lets you get information from multiple channels while looking at a single one. 
Deep neural networks can easilly handle the task of figuring out useful features for acoustic localization in simple noisy signals. 
Visually there was no discernible difference between the impulses. Now that I have all the machinery in place, I'm going to go bigger and transform my IKEA table to a "tap" screen! It would be amazing if it turns out this works with brushing sounds (then I would have a proper touch screen).

Hope you liked it! 
Harry







## Engineering application/motivation
<video width="720" height="480" controls="controls">
  <source src="/img/conditional_VAE_for_wind_turbine_blade_Fatigue.mp4" type="video/mp4">
</video>
